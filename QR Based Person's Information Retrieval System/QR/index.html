<?php
include('qrdata.php');

?>

<!doctype html>
<html lang="en">

<head>
	<title>Contact Form</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<link href='https://fonts.googleapis.com/css?family=Roboto:400,100,300,700' rel='stylesheet' type='text/css'>

	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

	<link rel="stylesheet" href="css/style.css">

</head>

<body>
	<script>
		function url() {
			const url = new URL(window.location.href);
			var n = url.searchParams.get('name');
			window.location.href = "http://localhost/fproject/index.html?name=" + n;
		}
	</script>
	<section class="ftco-section">
		<div class="container">
			<form style="text-align: right; margin-bottom: 0; padding-bottom: 0%;"
				action="http://localhost/fproject/index.html" method="post">
				<input type="button" class="btn btn-primary" value="Back To Home" onclick="url()">
			</form>
			<div class="row justify-content-center">
				<div class="col-md-6 text-center mb-0">
					<h2 class="heading-section">Contact Form</h2>
				</div>
			</div>
			<div class="row justify-content-center">
				<div class="col-md-12">
					<div class="wrapper">

						<div class="row">
							<div class="col-md-3">
								<div id="qrcode" class="mt-5 text-center">

								</div>
							</div>
							<div class="col-md-9">
								<div class="row no-gutters">
									<div class="col-lg-12 col-md-12 order-md-last d-flex align-items-stretch">
										<div class="contact-wrap w-100 p-md-5 p-4">
											<h3 class="mb-4">Enter your data</h3>
											<form method="POST" id="contactForm" name="contactForm" class="contactForm">
												<div class="row">
													<div class="col-md-6">
														<div class="form-group">
															<label class="label" for="name">Full Name</label>
															<input type="text" class="form-control" name="name"
																id="name" placeholder="Name">
														</div>
													</div>
													<div class="col-md-6">
														<div class="form-group">
															<label class="label" for="phno">Phone Number</label>
															<input type="tel" class="form-control" name="phno" id="phno"
																placeholder="Number">
														</div>
													</div>
													<div class="col-md-6">
														<div class="form-group">
															<label class="label" for="bgroup">Blood Group</label>
															<select id="bgroup">
																<option value=""> Select </option>
																<option value="A positive">A+</option>
																<option value="A Negative">A-</option>
																<option value="B positive">B+</option>
																<option value="B Negative">B-</option>
																<option value="AB positive">AB+</option>
																<option value="AB Negative">AB-</option>
																<option value="O positive">O+</option>
																<option value="O Negative">O-</option>
															</select>
														</div>
													</div>
													<div class="col-md-6">
														<div class="form-group">
															<label class="label" for="city">City, State</label>
															<input type="text" class="form-control" name="city"
																id="city" placeholder="City">
														</div>
													</div>
													<div class="col-md-6">
														<div class="form-group">
															<label class="label" for="gname">Guardian Name</label>
															<input type="text" class="form-control" name="gname"
																id="gname" placeholder="Guardian Name">
														</div>
													</div>
													<div class="col-md-6">
														<div class="form-group">
															<label class="label" for="gno">Guardian Number</label>
															<input type="tel" class="form-control" name="gno" id="gno"
																placeholder="Guardian Number">
														</div>
													</div>
													<div class="col-md-6">
														<div class="form-group">
															<label class="label" for="#">Medical Complications</label>
															<textarea name="message" class="form-control" id="message"
																cols="30" rows="4" placeholder="Message"></textarea>
														</div>

													</div>
													<div class="col-md-6">
														<div class="form-group">
															<input type="submit" value="Save Data"
																class="btn btn-primary" onclick="generateqr()">
															<div class="submitting"></div>
														</div>
														<div class="col-md-3">
															<div id="qrcode" class="mt-5 text-center"></div>
															<button id="saveQrButton" class="btn btn-primary">Save QR Code</button> 
														</div>
													</div>
												</div>
											</form>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		</div>
		</div>
		</div>
		</div>
	</section>


	<script src="js/jquery.min.js"></script>
	<script src="js/popper.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/jquery.validate.min.js"></script>
	<script src="js/main.js"></script>

	<script>

	function generateqr() {
    var name = document.getElementById('name').value;
    var phone = document.getElementById('phno').value;
    var bgroup = document.getElementById('bgroup').value;
    var city = document.getElementById('city').value;
    var gname = document.getElementById('gname').value;
    var gno = document.getElementById('gno').value;
    var message = document.getElementById('message').value;

    var data = ["NAME  : " + name + "</br> Phone  : " + phone + "</br> Blood group : " + bgroup + "</br> City, State  : " + city + "</br> Guardian Name : " + gname + "</br> Guardian Number : " + gno + "</br> Medical Complications : " + message];

    var url ="https://api.qrserver.com/v1/create-qr-code/?data=http://localhost/fproject/phptrial.php?Data=" + data;

    var img = `<img src="${url}" alt="QR Code">`;

    document.getElementById('qrcode').innerHTML = img;

	$('#saveQrButton').prop('disabled', false);

	$('#saveQrButton').click(function() {
    var qrImageUrl = $('#qrcode img').attr('src');
    var username = $('#name').val();

    
    $.ajax({
        url: 'save_qr.php',
        type: 'POST',
        data: { 
            qrContent: qrImageUrl, 
            username: username 
        },
        success: function(response) {
            alert(response); // Display the response message from save_qr.php
        },
        error: function() {
            alert('Error saving QR code!');
        }
    });
});
   }
 
   
	</script>

</body>

</html>